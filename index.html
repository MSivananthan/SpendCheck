<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpendCheck Pro - Secure Expense Tracker</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { width: 100%; height: 100%; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #0a1929; color: #e0f7fa; overflow-x: hidden; }
        
        #loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at top, #0f2027, #000); display: flex; align-items: center; justify-content: center; z-index: 10000; transition: opacity 0.5s ease-out; }
        .loader-container { text-align: center; padding: 20px; }
        .logo { display: flex; align-items: center; justify-content: center; gap: 14px; margin-bottom: 30px; }
        .shield { width: 72px; height: 82px; border: 3px solid #3dff7a; border-radius: 16px 16px 32px 32px; position: relative; box-shadow: 0 0 25px rgba(61,255,122,0.6); animation: pulse 2s infinite; background: linear-gradient(180deg, rgba(61,255,122,0.15), transparent); }
        .shield::before { content: "$"; position: absolute; top: 14px; left: 50%; transform: translateX(-50%); font-size: 30px; font-weight: bold; color: #9effa1; text-shadow: 0 0 10px rgba(158,255,161,0.8); }
        .shield::after { content: "✓"; position: absolute; bottom: 8px; left: 50%; transform: translateX(-50%); font-size: 26px; font-weight: bold; color: #3dff7a; text-shadow: 0 0 12px rgba(61,255,122,0.9); }
        .brand { font-size: clamp(1.8rem, 6vw, 2.5rem); font-weight: 800; letter-spacing: 1.6px; background: linear-gradient(90deg, #3dff7a, #4ddcff, #9effa1); background-size: 300%; -webkit-background-clip: text; -webkit-text-fill-color: transparent; animation: brandGlow 4s ease-in-out infinite; }
        .brand span { font-weight: 900; background: linear-gradient(90deg, #ffd166, #3dff7a); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .progress-box { width: min(280px, 80vw); height: 6px; background: rgba(255,255,255,0.12); border-radius: 6px; overflow: hidden; margin: 0 auto; }
        .progress { height: 100%; width: 0%; background: linear-gradient(90deg, #2aff6a, #4ddcff, #9effa1); animation: load 3s ease-in-out forwards; }
        .loading-text { margin-top: 14px; font-size: clamp(12px, 3vw, 14px); letter-spacing: 1.2px; opacity: 0.85; }
        
        #auth-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #0f2027 0%, #203a43 100%); display: none; z-index: 9999; overflow-y: auto; padding: 20px; }
        .auth-box { max-width: 400px; margin: 20px auto; padding: 30px 20px; background: rgba(22, 42, 54, 0.95); border-radius: 20px; box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5); border: 1px solid rgba(61, 255, 122, 0.2); }
        .auth-header { text-align: center; margin-bottom: 25px; }
        .auth-title { font-size: clamp(1.5rem, 5vw, 2rem); background: linear-gradient(90deg, #3dff7a, #4ddcff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 10px; }
        .auth-subtitle { color: #9effa1; opacity: 0.8; font-size: clamp(14px, 3vw, 16px); }
        .auth-form { margin-bottom: 20px; }
        .form-group { margin-bottom: 15px; }
        .form-label { display: block; margin-bottom: 8px; color: #4ddcff; font-weight: 600; font-size: clamp(14px, 3vw, 16px); }
        .form-input { width: 100%; padding: 12px 15px; border: 2px solid rgba(77, 220, 255, 0.3); border-radius: 10px; background: rgba(10, 25, 41, 0.7); color: #e0f7fa; font-size: 16px; transition: all 0.3s; }
        .form-input:focus { outline: none; border-color: #3dff7a; box-shadow: 0 0 15px rgba(61, 255, 122, 0.3); }
        .auth-btn { width: 100%; padding: 14px; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s; margin: 10px 0; }
        .btn-primary { background: linear-gradient(135deg, #00b09b 0%, #3dff7a 100%); color: #0a1929; }
        .btn-secondary { background: linear-gradient(135deg, #36d1dc 0%, #4ddcff 100%); color: #0a1929; }
        .btn-danger { background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%); color: white; }
        .auth-switch { text-align: center; margin-top: 20px; color: #b0e6ff; font-size: clamp(14px, 3vw, 16px); }
        .switch-link { color: #3dff7a; cursor: pointer; text-decoration: underline; font-weight: 600; }
        .error-message, .success-message { padding: 12px; border-radius: 8px; margin-bottom: 20px; display: none; font-size: clamp(14px, 3vw, 16px); }
        .error-message { background: rgba(255, 65, 108, 0.1); border: 1px solid rgba(255, 65, 108, 0.3); color: #ff9eb4; }
        .success-message { background: rgba(61, 255, 122, 0.1); border: 1px solid rgba(61, 255, 122, 0.3); color: #9effa1; }
        
        #app { display: none; width: 100%; min-height: 100vh; overflow-x: hidden; }
        .app-header { background: linear-gradient(135deg, #122832 0%, #1a3a47 100%); padding: 15px 20px; display: flex; flex-direction: column; gap: 15px; border-bottom: 2px solid rgba(61, 255, 122, 0.3); }
        @media (min-width: 768px) { .app-header { flex-direction: row; justify-content: space-between; align-items: center; } }
        .app-title-container { display: flex; align-items: center; gap: 12px; }
        .app-logo { width: 40px; height: 46px; border: 2px solid #3dff7a; border-radius: 10px 10px 20px 20px; position: relative; background: linear-gradient(180deg, rgba(61,255,122,0.1), transparent); }
        .app-logo::before { content: "$"; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) translateY(-6px); font-size: 18px; font-weight: bold; color: #9effa1; }
        .app-logo::after { content: "✓"; position: absolute; bottom: 4px; left: 50%; transform: translateX(-50%); font-size: 16px; font-weight: bold; color: #3dff7a; }
        .app-title { font-size: clamp(1.4rem, 5vw, 1.8rem); font-weight: 700; background: linear-gradient(90deg, #3dff7a, #4ddcff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .user-info { display: flex; flex-direction: column; gap: 10px; align-items: flex-start; }
        @media (min-width: 480px) { .user-info { flex-direction: row; align-items: center; } }
        .welcome-text { color: #9effa1; font-size: clamp(14px, 3vw, 16px); word-break: break-all; }
        .logout-btn { padding: 8px 16px; background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: clamp(14px, 3vw, 16px); white-space: nowrap; }
        .datetime-display { text-align: center; padding: 10px 15px; background: rgba(61, 255, 122, 0.1); border-bottom: 1px solid rgba(61, 255, 122, 0.2); font-size: clamp(14px, 3vw, 16px); color: #9effa1; }
        .main-content { display: flex; flex-direction: column; min-height: calc(100vh - 140px); }
        @media (min-width: 768px) { .main-content { flex-direction: row; } }
        .input-section { width: 100%; background: rgba(22, 42, 54, 0.9); padding: 20px; border-bottom: 1px solid rgba(77, 220, 255, 0.1); }
        @media (min-width: 768px) { .input-section { width: 380px; border-right: 1px solid rgba(77, 220, 255, 0.1); border-bottom: none; flex-shrink: 0; } }
        .history-section { flex: 1; padding: 20px; overflow-x: auto; }
        .expense-table-container { overflow-x: auto; margin-top: 20px; border-radius: 10px; border: 1px solid rgba(77, 220, 255, 0.1); }
        .expense-table { width: 100%; min-width: 700px; border-collapse: collapse; }
        .expense-table th { background: linear-gradient(135deg, #122832 0%, #1a3a47 100%); color: #9effa1; padding: 12px 15px; text-align: left; font-weight: 600; font-size: clamp(12px, 2.5vw, 14px); white-space: nowrap; }
        .expense-table td { padding: 10px 15px; border-bottom: 1px solid rgba(77, 220, 255, 0.1); color: #e0f7fa; font-size: clamp(12px, 2.5vw, 14px); }
        .expense-table tr:nth-child(even) { background-color: rgba(22, 42, 54, 0.5); }
        .amount-cell { font-weight: 700; color: #3dff7a; }
        .action-cell { display: flex; gap: 8px; }
        .action-btn { padding: 4px 8px; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: 600; }
        .edit-btn { background: rgba(77, 220, 255, 0.2); color: #4ddcff; border: 1px solid rgba(77, 220, 255, 0.4); }
        .delete-btn { background: rgba(255, 65, 108, 0.2); color: #ff9eb4; border: 1px solid rgba(255, 65, 108, 0.4); }
        .edit-log-btn { background: rgba(158, 255, 161, 0.2); color: #9effa1; border: 1px solid rgba(158, 255, 161, 0.4); }
        .no-expenses { text-align: center; padding: 40px 20px; color: #7a9eb1; font-style: italic; font-size: clamp(14px, 3vw, 16px); }
        .no-expenses i { font-size: clamp(2.5rem, 8vw, 4rem); margin-bottom: 15px; color: rgba(77, 220, 255, 0.3); }
        .summary-box { background: rgba(22, 42, 54, 0.9); padding: 15px; border-radius: 15px; margin: 15px 0; border: 1px solid rgba(77, 220, 255, 0.2); }
        .total-amount { font-size: clamp(1.8rem, 6vw, 2.5rem); font-weight: 800; color: #3dff7a; text-align: center; margin: 10px 0; }
        .action-buttons { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px; margin-top: 15px; }
        .section-title { color: #4ddcff; margin-bottom: 15px; font-size: clamp(1.2rem, 4vw, 1.5rem); display: flex; align-items: center; gap: 10px; }
        
        .filter-section { background: rgba(22, 42, 54, 0.9); padding: 15px; border-radius: 10px; margin-bottom: 20px; border: 1px solid rgba(77, 220, 255, 0.1); }
        .filter-row { display: flex; flex-wrap: wrap; gap: 15px; align-items: flex-end; }
        .filter-group { flex: 1; min-width: 150px; }
        .filter-label { display: block; margin-bottom: 8px; color: #4ddcff; font-size: 14px; font-weight: 600; }
        .filter-input { width: 100%; padding: 10px 12px; border: 1px solid rgba(77, 220, 255, 0.3); border-radius: 8px; background: rgba(10, 25, 41, 0.7); color: #e0f7fa; font-size: 14px; }
        .filter-actions { display: flex; gap: 10px; margin-top: 10px; }
        .filter-btn { padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 14px; }
        .apply-filter { background: linear-gradient(135deg, #00b09b 0%, #3dff7a 100%); color: #0a1929; }
        .clear-filter { background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%); color: white; }
        
        #edit-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); display: none; justify-content: center; align-items: center; z-index: 10001; }
        .modal-content { background: rgba(22, 42, 54, 0.98); padding: 30px; border-radius: 15px; width: 90%; max-width: 500px; border: 2px solid rgba(61, 255, 122, 0.3); box-shadow: 0 20px 50px rgba(0, 0, 0, 0.7); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .modal-title { font-size: 1.5rem; background: linear-gradient(90deg, #3dff7a, #4ddcff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .close-modal { background: none; border: none; color: #ff9eb4; font-size: 24px; cursor: pointer; padding: 0; }
        .edit-form .form-group { margin-bottom: 15px; }
        .edit-form-actions { display: flex; gap: 10px; margin-top: 20px; }
        
        #edit-log-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); display: none; justify-content: center; align-items: center; z-index: 10002; }
        .log-modal-content { background: rgba(22, 42, 54, 0.98); padding: 30px; border-radius: 15px; width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto; border: 2px solid rgba(61, 255, 122, 0.3); box-shadow: 0 20px 50px rgba(0, 0, 0, 0.7); }
        .log-list { margin-top: 15px; }
        .log-item { background: rgba(10, 25, 41, 0.5); border-radius: 8px; padding: 12px; margin-bottom: 10px; border: 1px solid rgba(77, 220, 255, 0.1); }
        .log-header { display: flex; justify-content: space-between; margin-bottom: 8px; }
        .log-timestamp { color: #9effa1; font-size: 12px; }
        .log-type { background: rgba(61, 255, 122, 0.2); color: #3dff7a; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 600; }
        .log-details { color: #e0f7fa; font-size: 14px; }
        .log-details span { color: #4ddcff; }
        
        .mobile-expense-list { display: none; }
        @media (max-width: 767px) {
            .expense-table-container { display: none; }
            .mobile-expense-list { display: block; margin-top: 20px; }
            .mobile-expense-item { background: rgba(22, 42, 54, 0.9); border: 1px solid rgba(77, 220, 255, 0.1); border-radius: 10px; padding: 15px; margin-bottom: 10px; }
            .mobile-expense-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
            .mobile-expense-sno { background: rgba(61, 255, 122, 0.1); color: #3dff7a; font-weight: bold; padding: 4px 10px; border-radius: 12px; font-size: 14px; }
            .mobile-expense-amount { font-size: 18px; font-weight: 700; color: #3dff7a; }
            .mobile-expense-name { font-weight: 600; margin-bottom: 5px; color: #e0f7fa; }
            .mobile-expense-datetime { display: flex; justify-content: space-between; color: #b0e6ff; font-size: 14px; margin-top: 8px; }
            .mobile-expense-actions { display: flex; gap: 8px; margin-top: 10px; }
            .mobile-action-btn { flex: 1; padding: 6px; border: none; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer; }
            .mobile-total-row { background: rgba(61, 255, 122, 0.1); border: 1px solid rgba(61, 255, 122, 0.3); font-weight: bold; padding: 15px; border-radius: 10px; margin-top: 10px; display: flex; justify-content: space-between; align-items: center; }
            .mobile-total-label { color: #9effa1; }
            .mobile-total-amount { color: #3dff7a; font-size: 20px; }
            .filter-row { flex-direction: column; }
            .filter-group { width: 100%; }
        }

        .copyright-text {
            text-align: center;
            color: #7a9eb1;
            font-size: 12px;
            font-style: italic;
            margin: 40px auto 20px auto;
            padding: 0 20px;
            max-width: 400px;
        }

        @keyframes load { from { width: 0; } to { width: 100%; } }
        @keyframes pulse { 0%, 100% { box-shadow: 0 0 22px rgba(61,255,122,0.5); } 50% { box-shadow: 0 0 38px rgba(61,255,122,0.9); } }
        @keyframes brandGlow { 0% { background-position: 0% } 50% { background-position: 100% } 100% { background-position: 0% } }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <div id="loader">
        <div class="loader-container">
            <div class="logo">
                <div class="shield"></div>
                <div class="brand">
                    Spend<span>Check</span> Pro
                </div>
            </div>
            <div class="progress-box">
                <div class="progress"></div>
            </div>
            <div class="loading-text" id="loadingText">Securing your expenses...</div>
        </div>
    </div>

    <div id="auth-container">
        <div class="auth-box" id="login-box">
            <div class="auth-header">
                <div class="auth-title">Welcome Back</div>
                <div class="auth-subtitle">Sign in to access your expenses</div>
            </div>
            <div class="error-message" id="login-error"></div>
            <div class="success-message" id="login-success"></div>
            <form class="auth-form" id="login-form">
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-envelope"></i> Email</label>
                    <input type="email" class="form-input" id="login-email" placeholder="Enter your email" required>
                </div>
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-lock"></i> Password</label>
                    <input type="password" class="form-input" id="login-password" placeholder="Enter your password" required>
                </div>
                <button type="submit" class="auth-btn btn-primary">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
            </form>
            <div class="auth-switch">
                Don't have an account? 
                <span class="switch-link" onclick="showSignup()">Sign Up</span>
            </div>
        </div>

        <div class="auth-box" id="signup-box" style="display: none;">
            <div class="auth-header">
                <div class="auth-title">Create Account</div>
                <div class="auth-subtitle">Start tracking your expenses securely</div>
            </div>
            <div class="error-message" id="signup-error"></div>
            <div class="success-message" id="signup-success"></div>
            <form class="auth-form" id="signup-form">
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-envelope"></i> Email</label>
                    <input type="email" class="form-input" id="signup-email" placeholder="Enter your email" required>
                </div>
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-lock"></i> Password</label>
                    <input type="password" class="form-input" id="signup-password" placeholder="Create a strong password" required>
                </div>
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-lock"></i> Confirm Password</label>
                    <input type="password" class="form-input" id="signup-confirm" placeholder="Confirm your password" required>
                </div>
                <button type="submit" class="auth-btn btn-primary">
                    <i class="fas fa-user-plus"></i> Sign Up
                </button>
            </form>
            <div class="auth-switch">
                Already have an account? 
                <span class="switch-link" onclick="showLogin()">Login</span>
            </div>
        </div>
        <div class="copyright-text">
            Made copyrights @sivananthanm
        </div>
    </div>

    <div id="edit-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title"><i class="fas fa-edit"></i> Edit Expense</h2>
                <button class="close-modal" onclick="closeEditModal()">&times;</button>
            </div>
            <form class="edit-form" id="edit-form">
                <input type="hidden" id="edit-expense-id">
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-tag"></i> Expense Name</label>
                    <input type="text" class="form-input" id="edit-expense-name" required>
                </div>
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-rupee-sign"></i> Amount (₹)</label>
                    <input type="number" class="form-input" id="edit-expense-amount" min="0" step="0.01" required>
                </div>
                <div class="edit-form-actions">
                    <button type="submit" class="auth-btn btn-primary">Update Expense</button>
                    <button type="button" class="auth-btn btn-danger" onclick="closeEditModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <div id="edit-log-modal">
        <div class="log-modal-content">
            <div class="modal-header">
                <h2 class="modal-title"><i class="fas fa-history"></i> Edit History</h2>
                <button class="close-modal" onclick="closeEditLogModal()">&times;</button>
            </div>
            <div id="edit-log-content">
            </div>
        </div>
    </div>

    <div id="app">
        <div class="app-header">
            <div class="app-title-container">
                <div class="app-logo"></div>
                <div class="app-title">Spend<span>Check</span> Pro</div>
            </div>
            <div class="user-info">
                <div class="welcome-text">Welcome, <span id="current-email">user@example.com</span></div>
                <button class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>
        
        <div class="datetime-display">
            <span id="current-date"></span> | <span id="current-time"></span>
        </div>
        
        <div class="main-content">
            <div class="input-section">
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-tag"></i> Expense Name</label>
                    <input type="text" class="form-input" id="expense-name" placeholder="e.g., Groceries, Transport">
                </div>
                
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-rupee-sign"></i> Amount (₹)</label>
                    <input type="number" class="form-input" id="expense-amount" placeholder="Enter amount" min="0" step="0.01">
                </div>
                
                <button class="auth-btn btn-primary" id="add-expense">
                    <i class="fas fa-plus-circle"></i> Add Expense
                </button>
                
                <div class="summary-box">
                    <h3><i class="fas fa-chart-line"></i> Current Summary</h3>
                    <p>Total Expenses: <span id="expense-count">0</span></p>
                    <div class="total-amount">₹ <span id="running-total">0.00</span></div>
                    <p>Last Added: <span id="last-added">None</span></p>
                </div>
                
                <div class="action-buttons">
                    <button class="auth-btn btn-secondary" id="export-pdf">
                        <i class="fas fa-file-pdf"></i> Export PDF
                    </button>
                    <button class="auth-btn btn-secondary" id="backup-data">
                        <i class="fas fa-download"></i> Backup
                    </button>
                    <button class="auth-btn btn-danger" id="clear-history">
                        <i class="fas fa-trash-alt"></i> Clear All
                    </button>
                </div>
            </div>
            
            <div class="history-section">
                <h2 class="section-title"><i class="fas fa-history"></i> Expense History</h2>
                
                <div class="filter-section">
                    <h3><i class="fas fa-filter"></i> Filter Expenses</h3>
                    <div class="filter-row">
                        <div class="filter-group">
                            <label class="filter-label">From Date</label>
                            <input type="date" class="filter-input" id="filter-from-date">
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">To Date</label>
                            <input type="date" class="filter-input" id="filter-to-date">
                        </div>
                    </div>
                    <div class="filter-actions">
                        <button class="filter-btn apply-filter" id="apply-filter">
                            <i class="fas fa-filter"></i> Apply Filter
                        </button>
                        <button class="filter-btn clear-filter" id="clear-filter">
                            <i class="fas fa-times"></i> Clear Filter
                        </button>
                    </div>
                </div>
                
                <div class="expense-table-container">
                    <table class="expense-table">
                        <thead>
                            <tr>
                                <th>S.No</th>
                                <th>Date</th>
                                <th>Time</th>
                                <th>Expense Name</th>
                                <th>Amount (₹)</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="expense-table-body">
                        </tbody>
                    </table>
                    <div id="no-expenses-message" class="no-expenses">
                        <i class="fas fa-receipt"></i>
                        <p>No expenses added yet. Start by adding your first expense!</p>
                    </div>
                </div>
                
                <div class="mobile-expense-list" id="mobile-expense-list">
                </div>
            </div>
        </div>
        <div class="copyright-text">
            Made copyrights @sivananthanm
        </div>
    </div>

    <script>
        let currentUser = null;
        let userExpenses = {};
        let currentExpenses = [];
        let filteredExpenses = [];
        let runningTotal = 0;
        let isFiltered = false;
        let currentFilter = null;
        
        const loaderTexts = [
            "Securing your expenses...",
            "Initializing security...",
            "Loading application...",
            "Almost ready..."
        ];
        
        let textIndex = 0;
        const loadingText = document.getElementById('loadingText');
        
        function updateLoaderText() {
            textIndex = (textIndex + 1) % loaderTexts.length;
            loadingText.textContent = loaderTexts[textIndex];
        }
        
        const loaderInterval = setInterval(updateLoaderText, 1000);
        
        setTimeout(() => {
            clearInterval(loaderInterval);
            document.getElementById('loader').style.opacity = '0';
            
            setTimeout(() => {
                document.getElementById('loader').style.display = 'none';
                showAuthPage();
            }, 500);
        }, 3000);
        
        function showAuthPage() {
            document.getElementById('auth-container').style.display = 'block';
            checkAutoLogin();
        }
        
        function showLogin() {
            document.getElementById('signup-box').style.display = 'none';
            document.getElementById('login-box').style.display = 'block';
            document.getElementById('login-error').style.display = 'none';
            document.getElementById('login-success').style.display = 'none';
        }
        
        function showSignup() {
            document.getElementById('login-box').style.display = 'none';
            document.getElementById('signup-box').style.display = 'block';
            document.getElementById('signup-error').style.display = 'none';
            document.getElementById('signup-success').style.display = 'none';
        }
        
        function showMessage(elementId, message, isError = true) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.style.display = 'block';
            
            if (isError) {
                element.className = 'error-message';
            } else {
                element.className = 'success-message';
            }
            
            setTimeout(() => {
                element.style.display = 'none';
            }, 5000);
        }
        
        function cleanText(text) {
            if (!text) return '';
            
            const textArea = document.createElement('textarea');
            textArea.innerHTML = text;
            let cleaned = textArea.value;
            
            cleaned = cleaned.replace(/&([a-zA-Z0-9]+);/g, '');
            cleaned = cleaned.replace(/&/g, '');
            
            return cleaned.trim();
        }
        
        function cleanExpenseData(expense) {
            return {
                ...expense,
                name: cleanText(expense.name),
                date: cleanText(expense.date),
                time: cleanText(expense.time),
                amount: typeof expense.amount === 'string' ? 
                       parseFloat(cleanText(expense.amount).replace(/[^\d.-]/g, '')) || 0 : 
                       expense.amount
            };
        }
        
        function cleanAllExpenses(expenses) {
            return expenses.map(expense => cleanExpenseData(expense));
        }
        
        function saveUserData() {
            try {
                if (currentUser && userExpenses[currentUser.email]) {
                    userExpenses[currentUser.email].expenses = currentExpenses;
                    userExpenses[currentUser.email].total = runningTotal;
                    userExpenses[currentUser.email].lastUpdated = new Date().toISOString();
                }
                localStorage.setItem('spendcheck_pro_users', JSON.stringify(userExpenses));
                localStorage.setItem('spendcheck_pro_current_user', JSON.stringify(currentUser));
            } catch (e) {
                console.error('Error saving user data:', e);
            }
        }
        
        function loadUserData() {
            try {
                const usersData = localStorage.getItem('spendcheck_pro_users');
                const currentUserData = localStorage.getItem('spendcheck_pro_current_user');
                
                if (usersData) {
                    userExpenses = JSON.parse(usersData);
                }
                
                if (currentUserData) {
                    currentUser = JSON.parse(currentUserData);
                    if (currentUser && userExpenses[currentUser.email]) {
                        currentExpenses = cleanAllExpenses(userExpenses[currentUser.email].expenses || []);
                        runningTotal = userExpenses[currentUser.email].total || 0;
                        
                        currentExpenses.forEach(expense => {
                            if (!expense.editLogs) {
                                expense.editLogs = [{
                                    timestamp: expense.createdAt || new Date().toISOString(),
                                    type: 'created',
                                    details: `Expense created: ${expense.name} - ₹${expense.amount.toFixed(2)}`
                                }];
                            }
                        });
                    }
                }
            } catch (e) {
                console.error('Error loading user data:', e);
                userExpenses = {};
                currentExpenses = [];
                runningTotal = 0;
            }
        }
        
        document.getElementById('signup-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const email = document.getElementById('signup-email').value.trim().toLowerCase();
            const password = document.getElementById('signup-password').value;
            const confirmPassword = document.getElementById('signup-confirm').value;
            
            if (!email || !password || !confirmPassword) {
                showMessage('signup-error', 'All fields are required');
                return;
            }
            
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                showMessage('signup-error', 'Please enter a valid email address');
                return;
            }
            
            if (password !== confirmPassword) {
                showMessage('signup-error', 'Passwords do not match');
                return;
            }
            
            if (password.length < 6) {
                showMessage('signup-error', 'Password must be at least 6 characters');
                return;
            }
            
            if (userExpenses[email]) {
                showMessage('signup-error', 'Email already registered. Please login instead.');
                return;
            }
            
            userExpenses[email] = {
                email: email,
                password: btoa(password),
                expenses: [],
                total: 0,
                createdAt: new Date().toISOString(),
                lastLogin: new Date().toISOString()
            };
            
            saveUserData();
            
            currentUser = {
                email: email
            };
            
            document.getElementById('signup-form').reset();
            
            showMessage('signup-success', 'Account created successfully! Logging you in...', false);
            
            setTimeout(() => {
                showApp();
            }, 1500);
        });
        
        document.getElementById('login-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const email = document.getElementById('login-email').value.trim().toLowerCase();
            const password = document.getElementById('login-password').value;
            
            if (!email || !password) {
                showMessage('login-error', 'Please enter email and password');
                return;
            }
            
            const user = userExpenses[email];
            
            if (!user) {
                showMessage('login-error', 'Invalid email or password');
                return;
            }
            
            if (btoa(password) !== user.password) {
                showMessage('login-error', 'Invalid email or password');
                return;
            }
            
            currentUser = {
                email: email
            };
            
            userExpenses[email].lastLogin = new Date().toISOString();
            
            currentExpenses = cleanAllExpenses(user.expenses || []);
            runningTotal = user.total || 0;
            
            currentExpenses.forEach(expense => {
                if (!expense.editLogs) {
                    expense.editLogs = [{
                        timestamp: expense.createdAt || new Date().toISOString(),
                        type: 'created',
                        details: `Expense created: ${expense.name} - ₹${expense.amount.toFixed(2)}`
                    }];
                }
            });
            
            saveUserData();
            
            document.getElementById('login-form').reset();
            
            showMessage('login-success', 'Login successful! Loading your data...', false);
            
            setTimeout(() => {
                showApp();
            }, 1000);
        });
        
        function checkAutoLogin() {
            loadUserData();
            if (currentUser && userExpenses[currentUser.email]) {
                showApp();
            }
        }
        
        function showApp() {
            document.getElementById('auth-container').style.display = 'none';
            document.getElementById('app').style.display = 'block';
            
            document.getElementById('current-email').textContent = currentUser.email;
            updateDateTime();
            setInterval(updateDateTime, 1000);
            updateSummary();
            renderExpenseTable();
            
            initializeAppListeners();
        }
        
        function logout() {
            saveUserData();
            
            currentUser = null;
            currentExpenses = [];
            filteredExpenses = [];
            runningTotal = 0;
            isFiltered = false;
            currentFilter = null;
            
            document.getElementById('app').style.display = 'none';
            document.getElementById('auth-container').style.display = 'block';
            showLogin();
        }
        
        function updateDateTime() {
            const now = new Date();
            document.getElementById('current-date').textContent = now.toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            document.getElementById('current-time').textContent = now.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: true
            });
        }
        
        function initializeAppListeners() {
            document.getElementById('add-expense').addEventListener('click', addExpense);
            document.getElementById('export-pdf').addEventListener('click', exportToPDF);
            document.getElementById('backup-data').addEventListener('click', backupData);
            document.getElementById('clear-history').addEventListener('click', clearHistory);
            document.getElementById('apply-filter').addEventListener('click', applyFilter);
            document.getElementById('clear-filter').addEventListener('click', clearFilter);
            document.getElementById('edit-form').addEventListener('submit', updateExpense);
            
            document.getElementById('expense-name').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    document.getElementById('expense-amount').focus();
                }
            });
            
            document.getElementById('expense-amount').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    addExpense();
                }
            });
        }
        
        function addExpense() {
            const nameInput = document.getElementById('expense-name');
            const amountInput = document.getElementById('expense-amount');
            
            const expenseName = nameInput.value.trim();
            const expenseAmount = parseFloat(amountInput.value);
            
            if (!expenseName) {
                alert('Please enter an expense name');
                nameInput.focus();
                return;
            }
            
            if (!expenseAmount || expenseAmount <= 0 || isNaN(expenseAmount)) {
                alert('Please enter a valid amount greater than 0');
                amountInput.focus();
                return;
            }
            
            const now = new Date();
            const expense = {
                id: Date.now(),
                date: now.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                }),
                time: now.toLocaleTimeString('en-US', {
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: true
                }),
                isoDate: now.toISOString(),
                name: expenseName,
                amount: expenseAmount,
                createdAt: now.toISOString(),
                editLogs: [{
                    timestamp: now.toISOString(),
                    type: 'created',
                    details: `Expense created: ${expenseName} - ₹${expenseAmount.toFixed(2)}`
                }]
            };
            
            currentExpenses.push(expense);
            runningTotal += expenseAmount;
            
            if (currentUser && userExpenses[currentUser.email]) {
                userExpenses[currentUser.email].expenses = currentExpenses;
                userExpenses[currentUser.email].total = runningTotal;
                saveUserData();
            }
            
            updateSummary();
            renderExpenseTable();
            
            nameInput.value = '';
            amountInput.value = '';
            nameInput.focus();
            
            const addButton = document.getElementById('add-expense');
            const originalHTML = addButton.innerHTML;
            addButton.innerHTML = '<i class="fas fa-check-circle"></i> Added!';
            
            setTimeout(() => {
                addButton.innerHTML = originalHTML;
            }, 1500);
        }
        
        function updateSummary() {
            const displayExpenses = isFiltered ? filteredExpenses : currentExpenses;
            const displayTotal = displayExpenses.reduce((sum, exp) => sum + exp.amount, 0);
            
            document.getElementById('expense-count').textContent = displayExpenses.length;
            document.getElementById('running-total').textContent = displayTotal.toFixed(2);
            
            if (displayExpenses.length > 0) {
                const lastExpense = displayExpenses[displayExpenses.length - 1];
                const cleanName = cleanText(lastExpense.name);
                document.getElementById('last-added').textContent = `${cleanName} - ₹${lastExpense.amount.toFixed(2)}`;
            } else {
                document.getElementById('last-added').textContent = 'None';
            }
        }
        
        function renderExpenseTable() {
            const displayExpenses = isFiltered ? filteredExpenses : currentExpenses;
            const tableBody = document.getElementById('expense-table-body');
            const noExpensesMessage = document.getElementById('no-expenses-message');
            const mobileList = document.getElementById('mobile-expense-list');
            
            tableBody.innerHTML = '';
            mobileList.innerHTML = '';
            
            if (displayExpenses.length === 0) {
                noExpensesMessage.style.display = 'block';
                mobileList.innerHTML = `
                    <div class="no-expenses">
                        <i class="fas fa-receipt"></i>
                        <p>${isFiltered ? 'No expenses found for the selected filter.' : 'No expenses added yet. Start by adding your first expense!'}</p>
                    </div>
                `;
                return;
            }
            
            noExpensesMessage.style.display = 'none';
            
            displayExpenses.forEach((expense, index) => {
                const cleanExpense = cleanExpenseData(expense);
                const cleanName = cleanExpense.name;
                const cleanAmount = `₹${cleanExpense.amount.toFixed(2)}`;
                const cleanDate = cleanExpense.date;
                const cleanTime = cleanExpense.time;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td style="font-weight:bold;color:#4ddcff;">${index + 1}</td>
                    <td>${cleanDate}</td>
                    <td>${cleanTime}</td>
                    <td>${cleanName}</td>
                    <td class="amount-cell">${cleanAmount}</td>
                    <td class="action-cell">
                        <button class="action-btn edit-btn" onclick="openEditModal(${expense.id})">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="action-btn edit-log-btn" onclick="showEditLogs(${expense.id})">
                            <i class="fas fa-history"></i> Log
                        </button>
                        <button class="action-btn delete-btn" onclick="deleteExpense(${expense.id})">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
                
                const mobileCard = document.createElement('div');
                mobileCard.className = 'mobile-expense-item';
                mobileCard.innerHTML = `
                    <div class="mobile-expense-header">
                        <div class="mobile-expense-sno">${index + 1}</div>
                        <div class="mobile-expense-amount">${cleanAmount}</div>
                    </div>
                    <div class="mobile-expense-name">${cleanName}</div>
                    <div class="mobile-expense-datetime">
                        <span>${cleanDate}</span>
                        <span>${cleanTime}</span>
                    </div>
                    <div class="mobile-expense-actions">
                        <button class="mobile-action-btn edit-btn" onclick="openEditModal(${expense.id})">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="mobile-action-btn edit-log-btn" onclick="showEditLogs(${expense.id})">
                            <i class="fas fa-history"></i> History
                        </button>
                        <button class="mobile-action-btn delete-btn" onclick="deleteExpense(${expense.id})">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                `;
                mobileList.appendChild(mobileCard);
            });
            
            const total = displayExpenses.reduce((sum, exp) => sum + exp.amount, 0);
            const totalRow = document.createElement('tr');
            totalRow.style.backgroundColor = 'rgba(61, 255, 122, 0.1)';
            totalRow.style.fontWeight = 'bold';
            totalRow.innerHTML = `
                <td colspan="4" style="text-align: right; padding-right: 20px;">
                    ${isFiltered ? 'FILTERED TOTAL' : 'TOTAL SPENT'}
                </td>
                <td class="amount-cell">₹${total.toFixed(2)}</td>
                <td></td>
            `;
            tableBody.appendChild(totalRow);
            
            const mobileTotal = document.createElement('div');
            mobileTotal.className = 'mobile-total-row';
            mobileTotal.innerHTML = `
                <div class="mobile-total-label">${isFiltered ? 'FILTERED TOTAL' : 'TOTAL SPENT'}</div>
                <div class="mobile-total-amount">₹${total.toFixed(2)}</div>
            `;
            mobileList.appendChild(mobileTotal);
        }
        
        function applyFilter() {
            const fromDate = document.getElementById('filter-from-date').value;
            const toDate = document.getElementById('filter-to-date').value;
            
            if (!fromDate && !toDate) {
                alert('Please select at least one date for filtering');
                return;
            }
            
            currentFilter = { fromDate, toDate };
            
            filteredExpenses = currentExpenses.filter(expense => {
                const expenseDate = new Date(expense.isoDate);
                
                if (fromDate && toDate) {
                    const from = new Date(fromDate);
                    const to = new Date(toDate);
                    to.setHours(23, 59, 59, 999);
                    return expenseDate >= from && expenseDate <= to;
                } else if (fromDate) {
                    const from = new Date(fromDate);
                    return expenseDate >= from;
                } else if (toDate) {
                    const to = new Date(toDate);
                    to.setHours(23, 59, 59, 999);
                    return expenseDate <= to;
                }
                return true;
            });
            
            isFiltered = true;
            updateSummary();
            renderExpenseTable();
            
            const filterButton = document.getElementById('apply-filter');
            const originalHTML = filterButton.innerHTML;
            filterButton.innerHTML = '<i class="fas fa-check-circle"></i> Applied!';
            
            setTimeout(() => {
                filterButton.innerHTML = originalHTML;
            }, 1500);
        }
        
        function clearFilter() {
            document.getElementById('filter-from-date').value = '';
            document.getElementById('filter-to-date').value = '';
            
            isFiltered = false;
            filteredExpenses = [];
            currentFilter = null;
            
            updateSummary();
            renderExpenseTable();
        }
        
        let editingExpenseId = null;
        
        function openEditModal(expenseId) {
            const expense = currentExpenses.find(exp => exp.id === expenseId);
            if (!expense) return;
            
            editingExpenseId = expenseId;
            
            document.getElementById('edit-expense-id').value = expenseId;
            document.getElementById('edit-expense-name').value = expense.name;
            document.getElementById('edit-expense-amount').value = expense.amount;
            
            document.getElementById('edit-modal').style.display = 'flex';
        }
        
        function closeEditModal() {
            document.getElementById('edit-modal').style.display = 'none';
            editingExpenseId = null;
            document.getElementById('edit-form').reset();
        }
        
        function updateExpense(e) {
            e.preventDefault();
            
            const expenseId = parseInt(document.getElementById('edit-expense-id').value);
            const newName = document.getElementById('edit-expense-name').value.trim();
            const newAmount = parseFloat(document.getElementById('edit-expense-amount').value);
            
            if (!newName || !newAmount || newAmount <= 0) {
                alert('Please enter valid expense details');
                return;
            }
            
            const expenseIndex = currentExpenses.findIndex(exp => exp.id === expenseId);
            if (expenseIndex === -1) return;
            
            const oldExpense = { ...currentExpenses[expenseIndex] };
            
            currentExpenses[expenseIndex].name = newName;
            currentExpenses[expenseIndex].amount = newAmount;
            currentExpenses[expenseIndex].isoDate = new Date().toISOString();
            currentExpenses[expenseIndex].date = new Date().toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
            currentExpenses[expenseIndex].time = new Date().toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit',
                hour12: true
            });
            
            currentExpenses[expenseIndex].editLogs.push({
                timestamp: new Date().toISOString(),
                type: 'updated',
                details: `Expense updated from "${oldExpense.name} - ₹${oldExpense.amount.toFixed(2)}" to "${newName} - ₹${newAmount.toFixed(2)}"`
            });
            
            runningTotal = currentExpenses.reduce((sum, exp) => sum + exp.amount, 0);
            
            if (currentUser && userExpenses[currentUser.email]) {
                userExpenses[currentUser.email].expenses = currentExpenses;
                userExpenses[currentUser.email].total = runningTotal;
                saveUserData();
            }
            
            if (isFiltered) {
                applyFilter();
            } else {
                updateSummary();
                renderExpenseTable();
            }
            
            closeEditModal();
        }
        
        function deleteExpense(expenseId) {
            if (!confirm('Are you sure you want to delete this expense?')) return;
            
            const expenseIndex = currentExpenses.findIndex(exp => exp.id === expenseId);
            if (expenseIndex === -1) return;
            
            const deletedExpense = currentExpenses[expenseIndex];
            
            currentExpenses.splice(expenseIndex, 1);
            
            runningTotal = currentExpenses.reduce((sum, exp) => sum + exp.amount, 0);
            
            if (currentUser && userExpenses[currentUser.email]) {
                userExpenses[currentUser.email].expenses = currentExpenses;
                userExpenses[currentUser.email].total = runningTotal;
                saveUserData();
            }
            
            if (isFiltered) {
                applyFilter();
            } else {
                updateSummary();
                renderExpenseTable();
            }
            
            alert(`Expense "${deletedExpense.name}" deleted successfully.`);
        }
        
        function showEditLogs(expenseId) {
            const expense = currentExpenses.find(exp => exp.id === expenseId);
            if (!expense || !expense.editLogs) return;
            
            const logContent = document.getElementById('edit-log-content');
            logContent.innerHTML = `
                <h3 style="margin-bottom: 10px; color: #4ddcff;">${expense.name} - ₹${expense.amount.toFixed(2)}</h3>
                <p style="color: #9effa1; margin-bottom: 15px;">Total edits: ${expense.editLogs.length}</p>
                <div class="log-list">
                    ${expense.editLogs.map((log, index) => `
                        <div class="log-item">
                            <div class="log-header">
                                <span class="log-timestamp">${new Date(log.timestamp).toLocaleString()}</span>
                                <span class="log-type">${log.type === 'created' ? 'Created' : 'Updated'}</span>
                            </div>
                            <div class="log-details">${log.details}</div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            document.getElementById('edit-log-modal').style.display = 'flex';
        }
        
        function closeEditLogModal() {
            document.getElementById('edit-log-modal').style.display = 'none';
        }
        
        function clearHistory() {
            if (currentExpenses.length === 0) {
                alert('No expenses to clear!');
                return;
            }
            
            if (confirm('⚠️ WARNING: This will delete ALL your expense history!\n\nAre you sure?')) {
                currentExpenses = [];
                filteredExpenses = [];
                runningTotal = 0;
                isFiltered = false;
                currentFilter = null;
                
                if (currentUser && userExpenses[currentUser.email]) {
                    userExpenses[currentUser.email].expenses = [];
                    userExpenses[currentUser.email].total = 0;
                    saveUserData();
                }
                
                updateSummary();
                renderExpenseTable();
            }
        }
        
        async function exportToPDF() {
            const displayExpenses = isFiltered ? filteredExpenses : currentExpenses;
            
            if (displayExpenses.length === 0) {
                alert('No expenses to export!');
                return;
            }
            
            try {
                const exportButton = document.getElementById('export-pdf');
                const originalHTML = exportButton.innerHTML;
                exportButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating PDF...';
                exportButton.disabled = true;
                
                const tempContainer = document.createElement('div');
                tempContainer.style.position = 'absolute';
                tempContainer.style.left = '-9999px';
                tempContainer.style.top = '-9999px';
                tempContainer.style.width = '794px';
                tempContainer.style.padding = '40px';
                tempContainer.style.backgroundColor = '#ffffff';
                tempContainer.style.fontFamily = "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif";
                tempContainer.style.color = '#000000';
                document.body.appendChild(tempContainer);
                
                const header = document.createElement('div');
                header.innerHTML = `
                    <div style="text-align: center; margin-bottom: 30px;">
                        <div style="display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 15px;">
                            <div style="width: 50px; height: 58px; border: 2px solid #3dff7a; border-radius: 10px 10px 20px 20px; position: relative; background: linear-gradient(180deg, rgba(61,255,122,0.1), transparent);">
                                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) translateY(-4px); font-size: 18px; font-weight: bold; color: #9effa1;">$</div>
                                <div style="position: absolute; bottom: 4px; left: 50%; transform: translateX(-50%); font-size: 16px; font-weight: bold; color: #3dff7a;">✓</div>
                            </div>
                            <h1 style="background: linear-gradient(90deg, #3dff7a, #4ddcff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; color: transparent; font-size: 32px; font-weight: 800;">
                                Spend<span style="font-weight: 900;">Check</span> Pro
                            </h1>
                        </div>
                        <h2 style="color: #0a1929; font-size: 24px; margin-bottom: 10px;">${isFiltered ? 'Filtered Expense Report' : 'Complete Expense Report'}</h2>
                        <div style="color: #666; font-size: 14px;">
                            Generated on: ${new Date().toLocaleDateString('en-US', {
                                weekday: 'long',
                                year: 'numeric',
                                month: 'long',
                                day: 'numeric'
                            })} at ${new Date().toLocaleTimeString('en-US', {
                                hour: '2-digit',
                                minute: '2-digit',
                                hour12: true
                            })}
                        </div>
                    </div>
                `;
                tempContainer.appendChild(header);
                
                const userInfo = document.createElement('div');
                userInfo.style.marginBottom = '20px';
                userInfo.style.padding = '15px';
                userInfo.style.backgroundColor = '#f0f9ff';
                userInfo.style.borderRadius = '8px';
                userInfo.style.border = '1px solid #4ddcff';
                
                let filterInfo = '';
                if (isFiltered && currentFilter) {
                    filterInfo = `
                        <p style="margin: 5px 0; color: #0a1929; font-size: 14px;">
                            <strong>Filter Range:</strong> 
                            ${currentFilter.fromDate ? `From: ${new Date(currentFilter.fromDate).toLocaleDateString()}` : ''}
                            ${currentFilter.toDate ? `To: ${new Date(currentFilter.toDate).toLocaleDateString()}` : ''}
                        </p>
                    `;
                }
                
                userInfo.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <p style="margin: 5px 0; color: #0a1929; font-size: 14px;"><strong>User:</strong> ${currentUser.email}</p>
                            ${filterInfo}
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 24px; font-weight: bold; color: #3dff7a;">
                                ₹${displayExpenses.reduce((sum, exp) => sum + exp.amount, 0).toFixed(2)}
                            </div>
                            <p style="margin: 5px 0; color: #0a1929; font-size: 14px;">Total Expenses: ${displayExpenses.length}</p>
                        </div>
                    </div>
                `;
                tempContainer.appendChild(userInfo);
                
                const table = document.createElement('table');
                table.style.width = '100%';
                table.style.borderCollapse = 'collapse';
                table.style.marginTop = '20px';
                table.style.fontSize = '12px';
                
                const thead = document.createElement('thead');
                thead.innerHTML = `
                    <tr style="background: linear-gradient(135deg, #122832 0%, #1a3a47 100%);">
                        <th style="padding: 12px 15px; text-align: left; color: #9effa1; font-weight: 600; border: none;">S.No</th>
                        <th style="padding: 12px 15px; text-align: left; color: #9effa1; font-weight: 600; border: none;">Date</th>
                        <th style="padding: 12px 15px; text-align: left; color: #9effa1; font-weight: 600; border: none;">Time</th>
                        <th style="padding: 12px 15px; text-align: left; color: #9effa1; font-weight: 600; border: none;">Expense Name</th>
                        <th style="padding: 12px 15px; text-align: left; color: #9effa1; font-weight: 600; border: none;">Amount (₹)</th>
                    </tr>
                `;
                table.appendChild(thead);
                
                const tbody = document.createElement('tbody');
                
                displayExpenses.forEach((expense, index) => {
                    const cleanExpense = cleanExpenseData(expense);
                    const cleanName = cleanExpense.name;
                    const cleanAmount = `₹${cleanExpense.amount.toFixed(2)}`;
                    const cleanDate = cleanExpense.date;
                    const cleanTime = cleanExpense.time;
                    
                    const row = document.createElement('tr');
                    row.style.backgroundColor = index % 2 === 0 ? '#f8f9fa' : '#ffffff';
                    
                    row.innerHTML = `
                        <td style="padding: 10px 15px; border-bottom: 1px solid #e0e0e0; font-weight: bold; color: #4ddcff;">${index + 1}</td>
                        <td style="padding: 10px 15px; border-bottom: 1px solid #e0e0e0; color: #333;">${cleanDate}</td>
                        <td style="padding: 10px 15px; border-bottom: 1px solid #e0e0e0; color: #333;">${cleanTime}</td>
                        <td style="padding: 10px 15px; border-bottom: 1px solid #e0e0e0; color: #333;">${cleanName}</td>
                        <td style="padding: 10px 15px; border-bottom: 1px solid #e0e0e0; font-weight: 700; color: #3dff7a;">${cleanAmount}</td>
                    `;
                    tbody.appendChild(row);
                });
                
                const total = displayExpenses.reduce((sum, exp) => sum + exp.amount, 0);
                const totalRow = document.createElement('tr');
                totalRow.style.backgroundColor = 'rgba(61, 255, 122, 0.1)';
                totalRow.style.fontWeight = 'bold';
                totalRow.innerHTML = `
                    <td colspan="4" style="padding: 12px 15px; text-align: right; color: #0a1929;">${isFiltered ? 'FILTERED TOTAL' : 'TOTAL SPENT'}</td>
                    <td style="padding: 12px 15px; color: #3dff7a; font-size: 14px;">₹${total.toFixed(2)}</td>
                `;
                tbody.appendChild(totalRow);
                
                table.appendChild(tbody);
                tempContainer.appendChild(table);
                
                const footer = document.createElement('div');
                footer.style.marginTop = '30px';
                footer.style.textAlign = 'center';
                footer.style.color = '#666';
                footer.style.fontSize = '12px';
                footer.style.borderTop = '1px solid #eee';
                footer.style.paddingTop = '10px';
                footer.innerHTML = 'Generated by SpendCheck Pro - Secure Expense Tracker • Report is for personal use only • Made copyrights @sivananthanm';
                tempContainer.appendChild(footer);
                
                const canvas = await html2canvas(tempContainer, {
                    scale: 2,
                    backgroundColor: '#ffffff',
                    useCORS: true,
                    logging: false
                });
                
                document.body.removeChild(tempContainer);
                
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4'
                });
                
                const imgWidth = 210;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                
                const imgData = canvas.toDataURL('image/png');
                doc.addImage(imgData, 'PNG', 0, 10, imgWidth, imgHeight);
                
                const now = new Date();
                const fileName = `SpendCheck_${isFiltered ? 'Filtered_' : ''}Report_${currentUser.email.replace(/[@.]/g, '_')}_${now.getFullYear()}_${(now.getMonth()+1).toString().padStart(2, '0')}_${now.getDate().toString().padStart(2, '0')}.pdf`;
                doc.save(fileName);
                
                exportButton.innerHTML = '<i class="fas fa-check-circle"></i> PDF Downloaded!';
                exportButton.style.background = 'linear-gradient(135deg, #3dff7a, #4ddcff)';
                
                setTimeout(() => {
                    exportButton.innerHTML = originalHTML;
                    exportButton.style.background = 'linear-gradient(135deg, #36d1dc 0%, #4ddcff 100%)';
                    exportButton.disabled = false;
                }, 2000);
                
            } catch (error) {
                console.error('PDF Export Error:', error);
                alert('Error generating PDF. Please try again.');
                
                const exportButton = document.getElementById('export-pdf');
                exportButton.innerHTML = '<i class="fas fa-file-pdf"></i> Export PDF';
                exportButton.disabled = false;
            }
        }
        
        function backupData() {
            const displayExpenses = isFiltered ? filteredExpenses : currentExpenses;
            
            if (displayExpenses.length === 0) {
                alert('No expenses to backup!');
                return;
            }
            
            try {
                const backup = {
                    user: currentUser,
                    expenses: displayExpenses,
                    total: displayExpenses.reduce((sum, exp) => sum + exp.amount, 0),
                    backupDate: new Date().toISOString(),
                    isFiltered: isFiltered,
                    filter: currentFilter
                };
                
                const dataStr = JSON.stringify(backup, null, 2);
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                const now = new Date();
                const fileName = `SpendCheck_${isFiltered ? 'Filtered_' : ''}Backup_${currentUser.email.replace(/[@.]/g, '_')}_${now.getFullYear()}_${(now.getMonth()+1).toString().padStart(2, '0')}_${now.getDate().toString().padStart(2, '0')}.json`;
                link.download = fileName;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                const backupButton = document.getElementById('backup-data');
                const originalHTML = backupButton.innerHTML;
                backupButton.innerHTML = '<i class="fas fa-check-circle"></i> Backup Saved!';
                backupButton.style.background = 'linear-gradient(135deg, #3dff7a, #4ddcff)';
                
                setTimeout(() => {
                    backupButton.innerHTML = originalHTML;
                    backupButton.style.background = 'linear-gradient(135deg, #36d1dc 0%, #4ddcff 100%)';
                }, 2000);
                
            } catch (error) {
                console.error('Backup Error:', error);
                alert('Error creating backup.');
            }
        }
        
        loadUserData();
        
        showLogin();
        
        window.addEventListener('beforeunload', function() {
            if (currentUser) {
                saveUserData();
            }
        });
    </script>
</body>
</html>